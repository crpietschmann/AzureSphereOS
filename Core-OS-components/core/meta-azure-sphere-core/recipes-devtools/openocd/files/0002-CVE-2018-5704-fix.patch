From 821e25a76eb011e4d0d81722e0ca75df26cef9de Mon Sep 17 00:00:00 2001
From: Azure Sphere Team <azuresphereoss@microsoft.com>
Date: Sun, 5 May 2019 02:00:01 -0700
Subject: [PATCH] Patch to address CVE-2018-5704

Prevent some forms of Cross Protocol Scripting attacks
Origin: http://openocd.zylin.com/#/c/4335/

---
diff --git a/src/server/startup.tcl b/src/server/startup.tcl
index 64ace40..09a53d7
--- a/src/server/startup.tcl
+++ b/src/server/startup.tcl
@@ -8,3 +8,13 @@ proc ocd_gdb_restart {target_id} {
 	# one target
 	reset halt
 }
+
+proc prevent_cross_protocol_attack {} {
+	echo "There was a POST or Host: command sent to OpenOCD."
+	echo "This is likely due to a malicious attempt to use Cross Protocol Scripting"
+	echo "to compromise your OpenOCD instance. Connection aborted."
+	exit
+}
+
+proc POST {args} { prevent_cross_protocol_attack }
+proc Host: {args} { prevent_cross_protocol_attack }
-- 
2.7.4

